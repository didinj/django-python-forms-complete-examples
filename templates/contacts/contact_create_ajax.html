{% extends "base.html" %} {% block content %}
<h1 class="mb-4">Create Contact (AJAX)</h1>

<form
  id="ajax-form"
  action="{% url 'contact_create_ajax' %}"
  method="post"
  novalidate
>
  {% csrf_token %} {% include "contacts/_contact_form_partial.html" %}
</form>

<div id="ajax-messages" class="mt-3"></div>

<script>
  const form = document.getElementById("ajax-form");
  const messages = document.getElementById("ajax-messages");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const response = await fetch(form.action, {
      method: "POST",
      body: formData,
      headers: {
        "X-Requested-With": "XMLHttpRequest"
      }
    });

    const data = await response.json();

    if (data.ok) {
      messages.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
      form.reset();
    } else {
      document.getElementById("form-container").innerHTML = data.form_html;
    }
  });
</script>
{% endblock %}
